# Websocket 底层信息传输

**数据建立：**它是通过HTTP/HTTPS握手请求升级到Websocket连接的

**数据传输：**使用数据帧传输，每个数据帧都包含了头部和数据载荷。

## 如果连接中断了如何恢复

Websocket没有自带的恢复方法，不过可以通过业务层（应用层）策略来保证数据不丢失。

### 自动连接

检测到连接断开了， 自动尝试重新连接。

### 心跳检测

定期发送心跳消息（ping/pong）检测连接状态

### 消息确认机制

发送方等待接收方的确认消息ACK，未确认则重发

### 序列号

每条消息都带序列号，保证消息顺序和完整性。

## 如何从http升级为websocket

客户端发送一个http请求，包含特殊的头字段要求升级为WebSocket协议

服务器接收后，进行验证，并返回一个同样包含特殊头字段的HTTP响应。

握手完成后，HTTP连接升级为WebSocket连接，进行全双工通信。