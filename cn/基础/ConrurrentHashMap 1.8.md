# ConrurrentHashMap 1.8

## 如何保证安全

 刚开始会使用CAS操作来进行无锁的并发更新，如果更新失败就会使用synchronized锁在特定的桶和节点上减少锁竞争和性能开销。。

## 扩容

如果发现当前容量超过阈值了，那么久就扩容



当我们使用sizeCtl作为控制标志，他的值为负数的时候表示正在扩容，值的绝对值代表着参与扩容的线程数量

通过CAS确保一个线程能成功的开始扩容，而其他线程则参与到正在扩容中。



创建新的数组，容量是原来的2倍



多个线程可以同时参与数据的迁移，每个线程负责一部分的数据迁移。（CPU核数和数组长度计算迁移步长，步长越小，分段越多）



然后更新table的引用，指向新的数据
