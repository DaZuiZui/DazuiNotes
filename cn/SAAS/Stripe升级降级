
# Stripe升级降级

当我们收到stripe的回调的时候意味着钱已经进入了stripe的口袋，

这个时候我们首先开始判断是升级还是降级的一个状态，然后根据我们的app_id选择一个对应的策略模式处理器进行处理。
然后去通过dobuypackage方法进行，首先会把旧资源全部清除掉（这是目前系统的一个不足，应该是补差额），然后插入新的资源。

然后在更新用户的订阅状态。然后还有续订记录表处理。

