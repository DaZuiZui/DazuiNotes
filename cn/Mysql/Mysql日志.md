# Mysql日志

## Binlog

Binlog是Mysql的二进制日志，主要记录所有对数据库进行改变的操作。

他可以做数据恢复，因为他可以重放所有的DML（数据操作语言）操作，实现数据的恢复。

**主从复制就是依赖Binlog实现的。包括如果我们误删除数据也可以通过这个实现恢复**

binlog是追加写入，不会覆盖以前的日志，因此可以做重放操作。

## Redo log(重做日志)

**数据恢复：** 用于崩溃恢复，数据库崩溃了以后，redo log可以恢复没有提交的数据的操作，从而确保一致性和持久化。

他主要做的事情就是保证事物的持久性（即使系统崩溃，已经提交的事物依然保留）

他记录的是数据页的物理变化（某个数据页某个位置做了什么操作），而不是具体的sql语句。

#### 解读

比如说我们修改了一个页的数据地0个位置为a那么存储的日志就是

页Id: 1

偏移量： 0

修改子节长度： 1

修改内存： A



Innodb是WAL机制，先写日志在写数据，他的工作流程是

1.事物执行开始

2.修改数据： 事物在内存（缓冲池）中修改数据页。

3.写redo log： 在事物提交前，将事物的所有修改记录到redo log。

4. redo log写完了就提交事物
5. 写入磁盘



## Undo log（回滚日志）

当事物失败或显示回滚，undo log 撤销已完成的操作。

MVCC：在inoodb中，undo log用于实现mvcc，可以让我们读的操作看见事物开始的时候的快照，从而实现读写分离。

记录的逻辑操作，比如删除的记录和更新前的数据。

每个事物都有自己的undo log，事物完成后会被清理

undo log存储的是修改前的数据快照。