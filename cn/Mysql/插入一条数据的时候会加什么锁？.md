# 插入一条数据的时候会加什么锁？

在设计多个列作为筛选条件，联合索引可以提高查询效率。

## 行锁

行锁是锁定单个数据行的锁，保护特定的记录不会被其他事物修改。插入完之后释放

## 间隙锁

间隙锁住要防止的是幻读，在默认隔离级别Repeatable read下，当你插入一条数据的时候，如果插入的位置处于已有记录之间的间隙，数据库可能会加间隙锁，防止其他事物在相同位置插入新的数据。

比如主键有10和20，这时候在主键值为15的位置插入新数据，innodb可能会在10和20加上间隙锁，这意味其他事物不能在这个间隙中加入新数据，除非当前事物完成。

在Repeatable read如果使用了行锁和间隙锁就会形成**Next key lock**

## 意图锁

意图图是一种特殊的间隙锁，他在多个事物尝试在相同位置插入记录的时候使用，这种锁可以让多个事物同事锁定相同的间隙，但是当一个事物真正插入记录的时，他会升级为行锁，阻止其他事物插入相同的位置，

**用途：** 插入间隙锁可以减少锁争用的范围，提高一个并发性能。

可能说的比较绕吧，我来举个例子吧，如果两个事物都要插入新记录到某个间隙，插入意图锁可以让这两个失误在间隙锁上排队，直刀其中一个事物完成插入操作。