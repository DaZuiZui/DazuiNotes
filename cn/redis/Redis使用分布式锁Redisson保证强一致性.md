# Redis使用分布式锁Redisson保证强一致性

## 原理

​	多个线程获取同一把锁，线程A获取到了锁，该锁的key就是UUID+线程ID作为key，保证我们当前的key和当前线程绑定在一起，然后在他的内部有一个子线程叫watchdog会每10秒检测一下是否还有锁如果持有的话就延迟时间给这把锁续命，如果我们使用的是Redis集群他还会通过hash算法选择对哪一个集群进行操作，如果没获取到锁他会进行自旋一直获取这个锁，直到超时为止。但是这时候还会出现一个问题，如果我们使用主从模式，我们的主节点死亡了，但是我们的redis使用的是AP模式，只能实现高性能高可用，不能保证高一致性，当我们设置锁的时候只能往一个节点设置锁，设置完之后就会立刻告诉你是否设置成功，然后他的内部进行同步，如果我们的主节点刚设置到锁，但是从节点还没同步到，依然还会发生线程不安全的情况（可能出现，主节点还没来得及同步，就宕机了，），所以redisson提供了RedLock，他的实现原理就是在多个Redis实列上设置相同的锁， 然后通过大多数节点的同意来确定是否获取锁，这样做的原因就是保证一些节点发生问题或者网络分区的情况下保证一致性，所有节点都同步完了在释放锁
