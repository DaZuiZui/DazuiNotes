# 类加载机制

jvm类加载主要做的事情就是把java类中的字节码加载到内存中，并转换为运行时的数据结构，主要有三个阶段：加载（Loding）、连接（Linking）、初始化（Initialization)

## 加载

加载主要做的事情就是将类的字节码加载道内存中，在加载阶段类加载器负责定位和读取类的字节码文件，然后并加载到JVM中，类加载阶段主要分为3个层次。

### 启动器加载（Bootstrap ClassLoader）

​	该阶段负责加载java的核心类库，如java.lang包中的类，启动类加载是由C++提供的。

### 扩展类加载（Extension Class）

​	负责java的扩展库类，位于java.ext.dirs系统所指定的目录中的类

### 应用程序类加载器

​	主要加载用户自定义的类。

当类被夹在的时候，它还没被初始化，只是在内存中生存了一个代表这个类的class对象，该对象包含了类的结构信息，但是还没初始化。

## 连接

连接分为3个阶段 验证、准备、解析

### 验证

验证被夹在的类的字节码是否合法，符合规范，且不会危害到虚拟机。

### 准备

为类的静态变量分配内存和默认初始值，但是不会涉及到类的静态变量初始化

### 解析

将类、方法、字段等符号引用解析为直接引用

## 初始化

这个这段jvm主要执行类构造器<clinit>方法的过程，这个方法是有编译器自动为类中所有类变了的赋值动作和静态代码块中的语句合并产生的。

在初始化阶段触发条件有，比如当遇见new字节码的时候，反射的时候，初始化一个类的时候发现父类还没被初始化，然后Main主类的时候，和在JDK1.7中引入的一些动态语言支持的时候，如果一个java.lang.invoke.MethodHandle实列最后的解析为REF_getStatic或者为REF_putStatic、REF-invokeStatic的某个方法的时候，就说明这个类没被初始化，就会进行初始化。



**对于一个类或接口来说，只有在真正使用到该类或接口的时候（  创建类的实列，创建类的静态变量和静态方法，反射强制创建对象，初始化某个类的子类），才会触发初始化阶段。这也是延迟加载的一种体现，可以提高程序的性能。**



**简单一句话，他就做了完成类的静态变量赋值、执行静态代码块和调用静态方法，确保类在使用前被正确准备和使用。**
