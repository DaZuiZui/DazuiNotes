# 长事物如何处理

之前有个业务是长时间数据同步的任务，涉及到的数据比较多，数据量特被打，直接同步回会导致接口响应时间超时，所以为了解决这个问题就异步任务的方式执行。



具体来说我们就先返回一个任务id给前端，然后通过消息队列异步执行，然后前端不断轮训这个任务id进行查看结果。



不过异步处理也有问题，比如如何保证一致性的问题。如何让用户感知任务的状态。



## 解决任务一致性的问题

任务一致性的问题主要依赖事物和幂等性设计来解决，单个任务在同一个事物内进行处理。幂等性就是为每个任务分配一个标识，确保这个标识只能有一个人在处理

## 多个任务操作同一份数据

如果这个时候我会使用Redis分布式锁或者乐观锁，来控制并发。



##  遇见过的问题

消息网络抖动吧，导致部分消息丢失， 所以引入了消息确认机制，只有消息最后成功处理才会从队列中移除。



## 与团队的配合

首先一定要写好日志，能够方便我们快速定位，然后就是容错能力，不能因为某个任务失败就影响整个系统，要把关键的任务和服务解耦，然后就是团队沟通问题，一定要写好文档。定期开会
