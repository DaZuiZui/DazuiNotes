# 通过消息队列AWQ SQS做限流/并发控制

业务背景：因为我们第三方服务vip等级比较低，所以当我们一次性给第三方AI太多任务的时候，他们会拒绝给我429，但是我们的业务只可以接受成功要不他们哪里出问题报错要不我们但是绝对不同意是429拒绝。这时候解决方案就是通过消息队列如果429错误那么我们抛出异常让消息进行重试，直到不被拒绝为止。确保任务完成。

- 基于 AWS SQS 的异步流水线与消费端限流策略，解决第三方 AI（SyncSo）并发配额导致的大量 429 问题，保证任务可恢复性与系统稳定性。
-  `AWS SQS` 的异步消费架构，解耦后端 AI 调用；通过消费者端流量控制与重试/退避策略，显著降低第三方 429 限流失败并保证任务可重试与进入 DLQ。
- 修复消息异常处理流程，确保遇到第三方 429 或保存失败时消息被正确重试或进入死信队列（DLQ），恢复丢失任务能力并提升系统稳定性。
- 增加告警与可观测（Feishu 通知、日志与 Trace），并实现幂等保存（以 `taskId` 唯一键）以避免重试时的重复写入